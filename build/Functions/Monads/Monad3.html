<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta http-equiv="content-security-policy" content=""><title>Promises</title>
	<link rel="stylesheet" href="/_app/assets/pages/__layout.svelte-b6adefe3.css">
	<link rel="stylesheet" href="/_app/assets/pages/Functions/__layout.svelte-45d8fac8.css">
	<link rel="stylesheet" href="/_app/assets/pages/Functions/Monads/__layout.svelte-ed3bdd87.css">
	<link rel="modulepreload" href="/_app/start-b6a591d0.js">
	<link rel="modulepreload" href="/_app/chunks/vendor-7ab9b2a4.js">
	<link rel="modulepreload" href="/_app/pages/__layout.svelte-31f91b2d.js">
	<link rel="modulepreload" href="/_app/pages/Functions/__layout.svelte-c22d6533.js">
	<link rel="modulepreload" href="/_app/pages/Functions/Monads/__layout.svelte-880bf17c.js">
	<link rel="modulepreload" href="/_app/pages/Functions/Monads/Monad3.svelte-05335dee.js">
				<script>
		if ('serviceWorker' in navigator) {
			navigator.serviceWorker.register('/service-worker.js');
		}
	</script>

<script
  src="https://code.jquery.com/jquery-1.12.4.min.js"
  integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ="
  crossorigin="anonymous"></script>

  <script
  src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
  integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
  crossorigin="anonymous"></script>

  <script src="https://cdn.socket.io/4.4.0/socket.io.min.js" integrity="sha384-1fOn6VtTq3PWwfsOrk45LnYcGosJwzMHv+Xh/Jx5303FVOXzEnw0EpLv30mtjmlj" crossorigin="anonymous"></script>


	</head>
	
	<body>
		<div id="svelte" >


<div><nav><ul class="svelte-1ofk2mc"><li class="svelte-1ofk2mc"><a href="/">Home</a></li>

    <li class="svelte-1ofk2mc"><a href="/Functions">Functions</a></li>

    <li class="svelte-1ofk2mc"><a href="/Mahjong">Riichi Mahjong</a></li>

    <li class="svelte-1ofk2mc"><a href="/Grammar">Grammar</a></li>

    <li class="svelte-1ofk2mc"><a href="/Law">Rule By Law</a></li></ul></nav></div>


<div></div>
<div class="container svelte-1ofk2mc"><br>
<div style="font-size: 26px">Functions</div>


<nav><ul class="svelte-14w1mcn"><li class="svelte-14w1mcn"><a href="/Functions/" class="svelte-14w1mcn">Home</a></li>

        <li class="svelte-14w1mcn"><a href="/Functions/haskell" class="svelte-14w1mcn">Haskell</a></li>

      	<li class="svelte-14w1mcn"><a href="/Functions/bitmask_prime_generator" class="svelte-14w1mcn">Primes</a></li>

		<li class="svelte-14w1mcn"><a href="/Functions/factors" class="svelte-14w1mcn">Factors</a></li>

		<li class="svelte-14w1mcn"><a href="/Functions/proxy" class="svelte-14w1mcn">Proxies</a></li>

        <li class="svelte-14w1mcn"><a class="large svelte-14w1mcn" href="/Functions/Monads">Monads</a></li>

        <li class="svelte-14w1mcn"><a class="large svelte-14w1mcn" href="/Functions/Binary_Operations">Binary</a></li>

		<li class="svelte-14w1mcn"><a href="/Functions/score" class="svelte-14w1mcn">Score</a></li></ul></nav>


<br>
<div style="font-size: 26px">Monads</div>


<nav><ul class="svelte-1e9oi5x"><li class="svelte-1e9oi5x"><a href="/Functions/Monads/" class="svelte-1e9oi5x">Home</a></li>

      	<li class="svelte-1e9oi5x"><a href="/Functions/Monads/Monad" class="svelte-1e9oi5x">Monads</a></li>

		<li class="svelte-1e9oi5x"><a href="/Functions/Monads/Monad0" class="svelte-1e9oi5x">A Simple Monad</a></li>

		<li class="svelte-1e9oi5x"><a href="/Functions/Monads/ObjectMonad" class="svelte-1e9oi5x">Object Monads</a></li>

        <li class="svelte-1e9oi5x"><a href="/Functions/Monads/Async_monad" class="svelte-1e9oi5x">Async Monad</a></li>

        <li class="svelte-1e9oi5x"><a href="/Functions/Monads/game" class="svelte-1e9oi5x">Score</a></li></ul></nav>




<div style="font-family: Times New Roman; text-align: center; font-size: 38px;"><p></p>
Promise Handling Monads
</div>
<p>If you click the buttons  (below) more than once, in any order, each routine will finish and then start over with the next function in the queue.</p>
<button style="text-align: left">test_3 ()
</button>

<button style="text-align: left">test_4 ()
</button>
<br><br>
<h3>lok is false</h3>
<h3>B[sym1] is </h3>
<h3>B[sym2] is </h3>
<h3>B[sym3] is </h3>

<pre style="font-size: 18">
const sym1 = Symbol(&#39;sym1&#39;);
const sym2 = Symbol(&#39;sym2&#39;);
const sym3 = Symbol(&#39;sym3&#39;);

const A = {};
const B = {};
  B[sym1] = [];
  B[sym2] = [];
  B[sym3] = [];</pre>
<p>&quot;A&quot; and &quot;B&quot; are global objects manipulated by the monadPlus function named &quot;Mona&quot;. There is no danger of name clashes, race conditions, or anything else untoward because this Svelte-Sapper module is small and unreachable from other modules. As Mona() changes B[sym1], B[sym2], and B[sym3], the browser display changes accordingly. Here&#39;s the dynamic display HTML:</p>

<pre style="font-size: 18">&lt;h3&gt;lok is {lok}&lt;/h3&gt;
&lt;h3&gt; B[sym1] is {B[sym1]} &lt;/h3&gt;
&lt;h3&gt; B[sym2] is {B[sym2]} &lt;/h3&gt;
&lt;h3&gt; B[sym3] is {B[sym3]} &lt;/h3&gt;</pre>
<p>And here&#39;s the code for the functions:</p>
<pre style="font-size: 18">let Mona = function Mona ( AR = [],  ar = &quot;name&quot; )  {  
  let p, run, f;
  B[ar] = AR.slice();
  let x = B[ar].slice(-1)[0] ;
  return run = (function run (x) {
  if (x instanceof Promise) {x.then(y =&gt; {
    if (!( typeof y === &quot;function&quot; || y == lok || y == NaN || y == undefined ||
      typeof y == &quot;undefined&quot; || y != y  ) ){B[ar] = B[ar].concat(y)}
    else if (typeof x !== &quot;function&quot; &amp;&amp; x != lok  &amp;&amp;  x != undefined  &amp;&amp; x != NaN  &amp;&amp; !(x instanceof Promise)) {B[ar] = B[ar].concat(x);
  }})}
    f = function f (func) {
      if (func === &#39;halt&#39; || func === &#39;h&#39; || func == undefined ||
        typeof func == &quot;undefined&quot; || func == NaN ) {
        B[ar] = B[ar]; 
        return B[ar].slice();
      }
      if (typeof func == &quot;function&quot; &amp;&amp; x instanceof Promise) p = x.then(v =&gt; func(v))
      else if (typeof func != &quot;function&quot; &amp;&amp; x instanceof Promise) p = x.then(v =&gt; v)
      else if (typeof func != &quot;function&quot;) p = func
      else p = func(x);
      return run(p);
    };
    return f;
  })(x);
}

function test_3 () {
  lok = true;
  A[sym1] = Mona([0], sym1);
  A[sym2] = Mona( [], sym2);
  A[sym3] = Mona([], sym3);
  A[sym1](addP(3))(cubeP)(addP(3))(squareP)(divP(100))(() =&gt; 
    branch(sym2,sym1)(idP)(squareP)(divP(27))(multP(7))(doubleP)(() =&gt; 
      branch(sym3,sym2)(idP)(() =&gt; B[sym1][1]+B[sym1][2]+B[sym1][3])
      (divP(10))(multP(7))(()=&gt;2+3+4+5)(multP(3))(() =&gt; 
        branch(sym1,sym2)(idP)(divP(7))(addP(8))(multP(3))
        (() =&gt; B[sym1].reduce((a,b) =&gt; a+b) - 42)
        (addP(-23))(divP(24))(() =&gt; pause(9))(() =&gt; lok = false)
      )
    )
  )  
}

function test_4 () {
  lok = true;
  A[sym1] = Mona([0], sym1);
  A[sym2] = Mona( [], sym2);
  A[sym3] = Mona([], sym3);
  A[sym1](addP(4))(cubeP)(addP(6))(squareP)(divP(100))(() =&gt; 

    branch(sym2,sym1)(idP)(squareP)(divP(7))(multP(3))(doubleP)(() =&gt; 

      branch(sym3,sym2)(idP)(() =&gt; B[sym1][1]+B[sym1][2]+B[sym1][3])
      (divP(23))(multP(7))(()=&gt;2+3+4+5)(multP(3))(() =&gt; 

        branch(sym1,sym2)(idP)(divP(343))(addP(7))(multP(400))
        (addP(-1000))(divP(100))(() =&gt; pause(9))(() =&gt; lok = false)
      )
    )
  )  
}

function branch (a, b) {  // Transfers a copy of the last item in A[b] to A[a]
  let c = A[b]().slice(-1);
  return A[a](c);
}

function resume (s) {return branch(s,s)}

var lok = false;

function start () {
  if (!lok) {
    test_3()
  }
  else {
    setTimeout(() =&gt; start(),300);
  }
}

function start_2 () {
  if (!lok) {
    test_4()
  }
  else {
    setTimeout(() =&gt; start_2(),300);
  }
}</pre>
  <br>
  <p></p>
  <br></div>


		<script type="module" data-hydrate="6treil">
		import { start } from "/_app/start-b6a591d0.js";
		start({
			target: document.querySelector('[data-hydrate="6treil"]').parentNode,
			paths: {"base":"","assets":""},
			session: {},
			route: true,
			spa: false,
			trailing_slash: "never",
			hydrate: {
				status: 200,
				error: null,
				nodes: [
					import("/_app/pages/__layout.svelte-31f91b2d.js"),
						import("/_app/pages/Functions/__layout.svelte-c22d6533.js"),
						import("/_app/pages/Functions/Monads/__layout.svelte-880bf17c.js"),
						import("/_app/pages/Functions/Monads/Monad3.svelte-05335dee.js")
				],
				params: {}
			}
		});
	</script></div>
	</body>
</html>
